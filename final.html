<!DOCTYPE html>
<html lang="en">
<head>
   <title>Welcome to Hogwarts!</title>
   <link rel="shortcut icon" href="bitbug_favicon.ico">
   <script src="https://d3js.org/d3.v7.min.js"></script>
   <style>
      body {
         background-image: url('background.jpg');
         background-size: cover;
         background-repeat: no-repeat;
         background-attachment: fixed;
         color: #ffffff;
         font-family: "Times New Roman", serif;
         margin: 0;
         padding: 0;
         text-align: center; 
      }

      h1, h2, h3, h4, h5, h6 {
         margin: 20px 0;
         text-shadow: 2px 2px 5px #000000;
      }

      h1 {
         font-size: 3em;
         color: #ffd700;
         text-transform: uppercase; 
      }

      h2 {
         font-size: 2.5em;
         color: #ffcc33;
      }

      .chart-container {
         background-color: rgba(0, 0, 0, 0.7);
         padding: 20px;
         margin: 20px auto;
         max-width: 800px; /* 缩小容器宽度 */
         display: block;
      }

      #chart {
         overflow: visible;
      }

      .bar {
         fill: #ffcc00; /* 更柔和的黄色 */
         transition: fill 0.3s ease; /* 添加颜色过渡效果 */
      }

      .bar:hover {
         fill: #ff9900; /* 悬停时更深的橙色 */
         cursor: pointer;
      }

      .tooltip {
         position: absolute;
         padding: 10px;
         background: rgba(0, 0, 0, 0.8);
         border: 1px solid #ffd700;
         border-radius: 5px;
         pointer-events: none;
         color: #fff;
         font-family: "Times New Roman", serif;
         font-size: 14px;
      }

      .axis-label {
         fill: #fff;
         font-family: "Times New Roman", serif;
         font-size: 14px;
      }

      .axis-line {
         stroke: #fff;
         stroke-width: 1;
      }
   </style>
</head>
<body>
   <h1>
      欢迎来到<mark><b>
         <ruby>霍<rt>táo</rt>格<rt>xué</rt>沃<rt>shèng</rt>兹<rt>dì</rt></ruby>
      </b></mark>魔法学院
   </h1>
   
   <div class="chart-container">
      <h2>哈利波特系列电影评分</h2>
      <div id="chart"></div>
   </div>

   <script>
      // 动态创建工具提示
      const tooltip = d3.select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

      // 设置图表尺寸
      const width = 700; // 缩小宽度
      const height = 400; // 缩小高度
      const margin = { top: 30, right: 30, bottom: 100, left: 50 }; // 调整边距

      // 创建SVG画布
      const svg = d3.select("#chart")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .style("background", "rgba(0, 0, 0, 0.3)")
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      // 加载和处理数据
      d3.csv("哈利波特数据.csv").then(data => {
         // 数据预处理
         const processedData = data
           .filter(d => d.排名 !== "无")
           .map(d => ({
             电影名: d.电影名.split(" ")[0], // 只保留中文电影名
             评分: +d.评分 // 转换为数字
           }))
           .sort((a, b) => d3.ascending(a.电影名, b.电影名));

         console.log("处理后的数据:", processedData);

         // 比例尺设置
         const x = d3.scaleBand()
           .domain(processedData.map(d => d.电影名))
           .range([0, width - margin.left - margin.right])
           .padding(0.2);

         const y = d3.scaleLinear()
           .domain([8, d3.max(processedData, d => d.评分)])
           .range([height - margin.top - margin.bottom, 0]);

         // 绘制柱状图
         svg.selectAll(".bar")
           .data(processedData)
           .enter()
           .append("rect")
           .attr("class", "bar")
           .attr("x", d => x(d.电影名))
           .attr("width", x.bandwidth())
           .attr("y", d => y(d.评分))
           .attr("height", d => height - margin.top - margin.bottom - y(d.评分))
           .on("mouseover", (event, d) => {
             tooltip.transition()
               .duration(200)
               .style("opacity", .9);
             tooltip.html(`
               <strong>${d.电影名}</strong><br>
               评分: ${d.评分}
             `)
               .style("left", (event.pageX + 10) + "px")
               .style("top", (event.pageY - 28) + "px");
           })
           .on("mouseout", () => {
             tooltip.transition()
               .duration(500)
               .style("opacity", 0);
           });

         // 添加X轴
         svg.append("g")
           .attr("transform", `translate(0, ${height - margin.top - margin.bottom})`)
           .call(d3.axisBottom(x).tickSizeOuter(0))
           .selectAll("text")
           .attr("transform", "rotate(-45)")
           .style("text-anchor", "end")
           .style("fill", "#fff")
           .style("font-size", "12px");

         // 添加Y轴
         svg.append("g")
           .call(d3.axisLeft(y).ticks(5).tickFormat(d => `${d}分`))
           .style("color", "#fff")
           .selectAll("text")
           .style("fill", "#fff")
           .style("font-size", "12px");

         // 添加Y轴标签
         svg.append("text")
           .attr("transform", "rotate(-90)")
           .attr("y", -margin.left + 10)
           .attr("x", -(height / 2))
           .attr("dy", "1em")
           .style("text-anchor", "middle")
           .style("fill", "#fff")
           .style("font-size", "14px")
           .text("评分");

         // 添加X轴标签
         svg.append("text")
           .attr("x", (width - margin.left - margin.right) / 2)
           .attr("y", height - margin.bottom + 40)
           .style("text-anchor", "middle")
           .style("fill", "#fff")
           .style("font-size", "14px")
           .text("电影名称");

      }).catch(error => {
         console.error("数据加载错误:", error);
         alert("数据加载失败，请检查控制台日志！");
      });
   </script>
</body>
</html>
